name: "Trigger PR"

on:
  push:
    branches:
      - mk/test-trigger

jobs:
  open-pr:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/workflows/env-setup
      - run: pnpm docs:graphql:generate
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "[Bot] Update Docs from updated GraphQL schema"
          push_options: "--force"
          branch: test-doc-update
          create_branch: true

      - name: Trigger Rafiki Dev Update
        uses: actions/github-script@v5
        with:
          script: |
            const listOfPRs = await github.rest.pulls.list({
              owner: 'interledger',
              repo: 'rafiki.dev',
              head: 'interledger:test-doc-update',
              state: 'open'
            });

            if (listOfPRs.data.length === 0) {
              await github.rest.pulls.create({
                owner: 'interledger',
                repo: 'rafiki.dev',
                body: 'Testing',
                title: 'Publish New Docs',
                head: 'test-doc-update',
                base: 'main'
              });
            }
